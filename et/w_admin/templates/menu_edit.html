{% extends base.html %}

{% block pos %}
编辑菜单
{% end %}

{% block main %}
<form method="post">
    <div class="formbody">

        <div class="formtitle"><span>菜单编辑</span></div>

        <ul class="forminfo">
            <li>
                <label>菜单名</label>
                <input name="name" type="text" class="dfinput" value="{{ bag.menu.name }}"/>
            </li>
            <li>
                <label>显示名</label>
                <input name="display_name" type="text" class="dfinput" value="{{ bag.menu.display_name }}"/>
            </li>
            <li>
                <label>描述</label>
                <input name="description" type="text" class="dfinput" value="{{ bag.menu.description }}"/>
            </li>
            <li>
                <label>级别</label>
                <input name="level" type="text" class="dfinput" value="{{ bag.menu.level }}"/>
            </li>
            <li>
                <label>父菜单</label>
                <select id="parent_menu" name="parent_menu" data-valField="id" data-txtField="display_name">
                    {% for pm in bag.parent_menus %}
                    <option value="{{ pm.id }}">{{ pm.display_name }}</option>
                    {% end %}
                </select>
            </li>
            <li>
                <label>url</label>
                <input name="url" type="text" class="dfinput" value="{{ bag.menu.url }}"/>
            </li>
            <li>
                <label>排序</label>
                <input name="order" type="text" class="dfinput" value="{{ bag.menu.order }}"/>
            </li>
            <li>
                <label>&nbsp;</label>
                <input type="submit" class="btn" value="确认保存"/>
            </li>
        </ul>
    </div>
</form>
</div>
{% end %}

{% block footer %}
<script type="text/javascript">
    $(function () {
        var parent_menus_ddl = $('#parent_menu').dropdown();

        $('input[name=level]').blur(function () {
            var self = $(this);
            var ddl = $('#parent_menus');
            var level = self.val();
            level = parseInt(level) - 1;
            $.ajax({
                url: '/load_menus',
                type: 'GET',
                data: {
                    level: level
                },
                success: function (resp) {
                    if (resp.status === 0) {
                        {#                        var ddlContainer = ddl.find('ul');#}
                        {#                        ddlContainer.empty();#}
                        {#                        $.each(resp.data, function (index, item) {#}
                        {#                            $('<li>')#}
                        {#                                    .text(item.display_name)#}
                        {#                                    .val(item.id).appendTo(ddlContainer);#}
                        {#                        });#}
                        {#                        initDropdownList(ddl);#}
                        parent_menus_ddl.load(resp.data);
                    } else {
                        alert(resp.msg);
                    }
                },
                error: function () {
                    alert('加载菜单出错');
                }
            });
        });
    });

</script>
{% end %}