{% extends base.html %}

{% block pos %}
编辑部门
{% end %}

{% block main %}
<form id="department_form" method="post">
    <div class="formbody">
        <div class="formtitle"><span>部门编辑</span></div>

        <ul class="forminfo">
            <li>
                <label>部门名称</label>
                <input name="name" type="text" class="dfinput" value="{{ model.name }}"/>
            </li>
            <li>
                <label>默认菜单</label>
                <div class="vocation">
                    <select id="default_menu" name="default_menu">
                        <option value="-1">
                            请选择
                        </option>
                        {% for menu in bag.menus %}
                        <option value="{{ menu.id }}"
                                {% if menu.id == model.default_top_menu.id %}selected{% end %}>{{ menu.display_name }}</option>
                        {% end %}
                    </select>
                </div>
            </li>

            <li>
                <label>&nbsp;</label>
                <input type="submit" class="btn" value="确认保存"/>
            </li>
        </ul>
    </div>
</form>
</div>
{% end %}

{% block footer %}
<script type="text/javascript">
    $(function () {
        //表单验证
        $('#department_form').validate({
            errorElement: 'p',
            errorClass: 'valid-error',
            rules: {
                name: {
                    required: true
                },
                default_menu: {
                    selected: true
                }
            },
            messages: {
                name: {
                    required: '请填写部门名称'
                },
                default_menu: {
                    selected: '请选择默认菜单'
                }
            },
            submitHandler: function (form) {
                $(form).ajaxSubmit({
                    dataType: 'JSON',
                    success: function (resp) {
                        if (resp.status === 0) {
                            alert('保存成功');
                        } else {
                            alert(resp.msg);
                        }
                    },
                    error: function () {
                        alert('提交失败');
                    }
                });
            }
        });

        $.validator.addMethod('selected', function (value, element) {
            return this.optional(element) || value != -1;
        });
    });
</script>
{% end %}